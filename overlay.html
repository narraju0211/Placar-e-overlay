<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Placar ao Vivo Overlay</title>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800;900&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color-rgb: 24, 24, 27; /* Darker gray/black */
            --font-color-rgb: 255, 255, 255; /* White */
            --border-color: #64ffda; /* Aqua/Cyan */
            --timer-color: #00ffff; /* Brighter Cyan */
            --score-bg-color: rgba(0, 0, 0, 0.4);
        }

        body {
            margin: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: flex-end; /* Alinha o placar na parte de baixo da tela */
            height: 100vh; /* Ocupa a altura total da viewport */
            font-family: 'Montserrat', sans-serif;
            color: rgba(var(--font-color-rgb), 1);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            padding-bottom: 20px; /* Espaço para o placar não ficar colado na borda */
            background: transparent; /* Importante para a overlay no OBS */
        }

        .overlay-container {
            display: flex;
            flex-direction: row; /* Alinha os itens horizontalmente */
            justify-content: space-around; /* Espaçamento entre os itens */
            align-items: center; /* Alinha verticalmente ao centro */
            width: 98%;
            max-width: 1800px; /* Ajuste conforme a largura desejada para a overlay */
            height: auto; /* Altura se ajusta ao conteúdo */
            background-color: rgba(var(--bg-color-rgb), 0.8);
            border-radius: 15px; /* Mais arredondado ou menos, você decide */
            border: 2px solid var(--border-color);
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5);
            padding: 10px 30px; /* Padding interno para o conteúdo */
            box-sizing: border-box;
            position: relative;
            transition: background-color 0.5s ease, border-color 0.5s ease, color 0.5s ease;
        }

        /* Estilo dos times (flex-column para logo e nome) */
        .team {
            display: flex;
            flex-direction: column; /* Logo e nome um abaixo do outro */
            align-items: center; /* Centralizar logo e nome */
            gap: 5px; /* Espaço entre logo e nome */
            flex-shrink: 0; /* Impede que os times encolham demais */
            min-width: 150px; /* Largura mínima para o bloco do time */
        }

        .team-logo {
            width: 100px; /* Escudos maiores */
            height: 100px;
            object-fit: contain; /* Garante que a imagem caiba sem distorcer */
            filter: drop-shadow(0 0 8px rgba(0,0,0,0.6)); /* Sombra para destacar */
            transition: transform 0.2s ease-out; /* Transição para animação do salto */
        }

        .team-info {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .team-name {
            font-size: 1.6em; /* Tamanho do nome */
            font-weight: 800;
            white-space: nowrap; /* Evita que o nome quebre linha */
            overflow: hidden;
            text-overflow: ellipsis; /* Adiciona "..." se o nome for muito longo */
            max-width: 200px; /* Largura máxima para o nome do time */
            text-align: center;
        }

        .team-abbr {
            font-size: 0.9em; /* Tamanho da sigla */
            font-weight: 600;
            color: rgba(var(--font-color-rgb), 0.7);
            margin-top: -3px; /* Aproxima da sigla */
        }

        .score {
            font-family: 'Roboto Mono', monospace;
            font-size: 4.5em; /* Tamanho do placar */
            font-weight: 800;
            background-color: var(--score-bg-color);
            padding: 5px 18px;
            border-radius: 10px;
            min-width: 90px; /* Largura mínima para o placar */
            text-align: center;
            box-shadow: inset 0 0 12px rgba(0,0,0,0.3);
            margin: 0 15px; /* Margem entre placar e outros elementos */
            flex-shrink: 0;
        }

        .center-elements {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            min-width: 160px; /* Largura mínima para o centro */
        }

        .timer {
            font-family: 'Roboto Mono', monospace;
            font-size: 2.8em; /* Tamanho do timer */
            font-weight: 700;
            color: var(--timer-color);
            background-color: var(--score-bg-color);
            padding: 5px 12px;
            border-radius: 10px;
            box-shadow: 0 0 12px rgba(0, 255, 255, 0.5);
            text-shadow: 0 0 6px rgba(0, 255, 255, 0.5);
            min-width: 110px;
            text-align: center;
        }

        .period {
            font-size: 1.1em; /* Tamanho do período */
            font-weight: 600;
            margin-top: 5px;
            color: rgba(var(--font-color-rgb), 0.8);
        }

        /* Cartões */
        .cards {
            display: flex;
            gap: 4px;
            margin-top: 5px;
            height: 25px; /* Altura fixa para manter alinhamento */
        }
        .card {
            width: 18px;
            height: 25px;
            border-radius: 3px;
            background-color: gray;
            border: 1px solid rgba(0,0,0,0.3);
            box-shadow: 0 1px 4px rgba(0,0,0,0.4);
        }
        .card.yellow { background-color: #ffeb3b; }
        .card.red { background-color: #f44336; }

        /* Logo Central */
        .logo-central {
            position: absolute; /* Posiciona absolutamente */
            top: 50%; /* Centraliza verticalmente */
            left: 50%; /* Centraliza horizontalmente */
            transform: translate(-50%, -50%); /* Ajusta para o centro exato */
            height: 80%; /* Altura da logo em relação ao container */
            width: auto;
            max-width: 250px;
            object-fit: contain;
            opacity: 0.1; /* Transparente para não atrapalhar a leitura */
            z-index: -1; /* Fica atrás dos outros elementos */
            pointer-events: none; /* Não interfere com cliques */
        }

        /* Penalty Mode */
        .penalty-mode .hide-on-penalty {
            opacity: 0;
            pointer-events: none;
            visibility: hidden;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        .penalty-dots {
            display: flex;
            gap: 8px;
            position: absolute;
            bottom: 10px; /* Posição dos pontos */
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        .penalty-mode .penalty-dots {
            opacity: 1;
        }

        .penalty-dots#penaltyDotsTeam1 {
            left: 10%; /* Ajuste a posição para o time 1 */
        }
        .penalty-dots#penaltyDotsTeam2 {
            right: 10%; /* Ajuste a posição para o time 2 */
        }

        .penalty-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: rgba(var(--font-color-rgb), 0.3); /* Cinza padrão */
            border: 1px solid rgba(var(--font-color-rgb), 0.5);
            box-shadow: inset 0 0 5px rgba(0,0,0,0.3);
        }
        .penalty-dot.green {
            background-color: #4caf50; /* Verde para gol */
            border-color: #81c784;
            box-shadow: 0 0 8px #4caf50;
        }
        .penalty-dot.red {
            background-color: #f44336; /* Vermelho para erro */
            border-color: #ef9a9a;
            box-shadow: 0 0 8px #f44336;
        }

        /* Animações */
        @keyframes goalFlash {
            0%, 100% { background-color: rgba(var(--bg-color-rgb), 0.8); }
            50% { background-color: rgba(255, 223, 0, 0.9); } /* Amarelo dourado */
        }

        .overlay-container.goal-animation {
            animation: goalFlash 1.5s ease-in-out;
        }

        @keyframes escudoSalto {
            0% { transform: translateY(0) scale(1); }
            25% { transform: translateY(-15px) scale(1.1); } /* Sobe e aumenta um pouco */
            50% { transform: translateY(0) scale(1); }
            75% { transform: translateY(-8px) scale(1.05); } /* Pequeno ressalto */
            100% { transform: translateY(0) scale(1); }
        }

        .goal-scored-animation {
            animation: escudoSalto 0.7s ease-out; /* Duração e tipo de animação */
        }

    </style>
</head>
<body>
    <div class="overlay-container" id="overlayContainer">
        <img id="logoCentral" class="logo-central" src="" alt="Logo Central">

        <div class="team" id="team1">
            <img id="escudo1" class="team-logo" src="" alt="Escudo Time 1">
            <div class="team-info hide-on-penalty">
                <span id="nomeTime1" class="team-name">Nome Time 1</span>
                <span id="nomeAbbr1" class="team-abbr">T1</span>
                <div id="cardsTeam1" class="cards"></div>
            </div>
            <div id="penaltyDotsTeam1" class="penalty-dots"></div>
        </div>

        <span id="placar1" class="score">0</span>
        
        <span class="score">-</span> 
        
        <span id="placar2" class="score">0</span>

        <div class="center-elements hide-on-penalty">
            <div id="timer" class="timer">00:00</div>
            <div id="periodo" class="period">1º Tempo</div>
        </div>

        <div class="team" id="team2">
            <img id="escudo2" class="team-logo" src="" alt="Escudo Time 2">
            <div class="team-info hide-on-penalty">
                <span id="nomeTime2" class="team-name">Nome Time 2</span>
                <span id="nomeAbbr2" class="team-abbr">T2</span>
                <div id="cardsTeam2" class="cards"></div>
            </div>
            <div id="penaltyDotsTeam2" class="penalty-dots"></div>
        </div>
    </div>

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            // Suas configurações do Firebase aqui (apiKey, authDomain, databaseURL, projectId, storageBucket, messagingSenderId, appId)
            // Exemplo:
            // apiKey: "YOUR_API_KEY",
            // authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            // databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
            // projectId: "YOUR_PROJECT_ID",
            // storageBucket: "YOUR_PROJECT_ID.appspot.com",
            // messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            // appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const overlayRef = database.ref('overlayState'); // Referência ao estado da overlay no Firebase

        // Elementos HTML
        const overlayContainer = document.getElementById('overlayContainer');
        const nomeTime1 = document.getElementById('nomeTime1');
        const nomeAbbr1 = document.getElementById('nomeAbbr1');
        const escudo1 = document.getElementById('escudo1');
        const placar1 = document.getElementById('placar1');
        const cardsTeam1 = document.getElementById('cardsTeam1');

        const nomeTime2 = document.getElementById('nomeTime2');
        const nomeAbbr2 = document.getElementById('nomeAbbr2');
        const escudo2 = document.getElementById('escudo2');
        const placar2 = document.getElementById('placar2');
        const cardsTeam2 = document.getElementById('cardsTeam2');

        const timerElement = document.getElementById('timer');
        const periodoElement = document.getElementById('periodo');
        const logoCentral = document.getElementById('logoCentral');

        const penaltyDotsTeam1 = document.getElementById('penaltyDotsTeam1');
        const penaltyDotsTeam2 = document.getElementById('penaltyDotsTeam2');

        let lastGoalScoredTeam = null; // Variável para controlar qual time fez o último gol

        // Função para atualizar os cartões
        function updateCards(cardsContainer, countYellow, countRed) {
            cardsContainer.innerHTML = ''; // Limpa os cartões existentes

            for (let i = 0; i < countYellow; i++) {
                const card = document.createElement('div');
                card.className = 'card yellow';
                cardsContainer.appendChild(card);
            }
            for (let i = 0; i < countRed; i++) {
                const card = document.createElement('div');
                card.className = 'card red';
                cardsContainer.appendChild(card);
            }
        }

        // Função para atualizar os pontos de pênalti
        function updatePenaltyDots(dotsContainer, results) {
            dotsContainer.innerHTML = '';
            results.forEach(result => {
                const dot = document.createElement('div');
                dot.className = `penalty-dot ${result ? 'green' : 'red'}`;
                dotsContainer.appendChild(dot);
            });
        }

        // Função para disparar a animação de gol
        function triggerGoalAnimation() {
            overlayContainer.classList.add('goal-animation'); // Animação de fundo
            if (lastGoalScoredTeam === '1') {
                escudo1.classList.add('goal-scored-animation'); // Animação do escudo
            } else if (lastGoalScoredTeam === '2') {
                escudo2.classList.add('goal-scored-animation'); // Animação do escudo
            }

            setTimeout(() => {
                overlayContainer.classList.remove('goal-animation');
                escudo1.classList.remove('goal-scored-animation');
                escudo2.classList.remove('goal-scored-animation');
                lastGoalScoredTeam = null; // Reset para o próximo gol
            }, 2500); // Duração total da animação (2.5s para o fundo, escudo dentro desse tempo)
        }

        // Listener para o Firebase
        overlayRef.on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                // Atualiza informações dos times
                nomeTime1.textContent = data.nomeTime1 || 'TIME CASA';
                nomeAbbr1.textContent = data.nomeAbbr1 || 'CSA';
                escudo1.src = data.escudo1 || '';
                placar1.textContent = data.placar1 !== undefined ? data.placar1 : 0;
                updateCards(cardsTeam1, data.cartoesAmarelo1 || 0, data.cartoesVermelho1 || 0);

                nomeTime2.textContent = data.nomeTime2 || 'TIME FORA';
                nomeAbbr2.textContent = data.nomeAbbr2 || 'FOR';
                escudo2.src = data.escudo2 || '';
                placar2.textContent = data.placar2 !== undefined ? data.placar2 : 0;
                updateCards(cardsTeam2, data.cartoesAmarelo2 || 0, data.cartoesVermelho2 || 0);

                // Atualiza Timer e Período
                timerElement.textContent = data.timer || '00:00';
                periodoElement.textContent = data.periodo || '1º Tempo';

                // Atualiza Logo Central (se houver)
                logoCentral.src = data.logoCentral || '';
                logoCentral.style.opacity = data.showLogoCentral ? 0.1 : 0; // Exibe/oculta a logo central

                // Controla a visibilidade da overlay
                overlayContainer.style.opacity = data.isVisible ? 1 : 0;

                // Modo de pênalti
                if (data.penaltyMode) {
                    overlayContainer.classList.add('penalty-mode');
                    updatePenaltyDots(penaltyDotsTeam1, data.penaltyResults1 || []);
                    updatePenaltyDots(penaltyDotsTeam2, data.penaltyResults2 || []);
                } else {
                    overlayContainer.classList.remove('penalty-mode');
                }

                // Dispara animação de gol APENAS se o estado no Firebase mudou e um gol foi marcado
                // Você precisará adicionar um campo 'lastGoalScoredTeam' no Firebase do seu control.html
                // quando um gol for marcado.
                if (data.lastGoalScoredTeam && data.lastGoalScoredTeam !== lastGoalScoredTeam) {
                    lastGoalScoredTeam = data.lastGoalScoredTeam; // Atualiza a variável local
                    triggerGoalAnimation();
                } else if (!data.lastGoalScoredTeam) {
                    // Reseta lastGoalScoredTeam localmente se não houver gol recente no Firebase
                    lastGoalScoredTeam = null;
                }
            }
        });

        // Exemplo de como você atualizaria o lastGoalScoredTeam no seu CONTROL.HTML (para sua referência)
        // No seu control.html, quando você adicionar um gol:
        // function updatePlacar(team, value) {
        //     let updates = {};
        //     updates[`/placar${team}`] = Math.max(0, controlOverlayState[`placar${team}`] + value);
        //     if (value > 0) { // Se for um gol
        //         updates['/lastGoalScoredTeam'] = team; // Adiciona qual time marcou
        //     } else {
        //         updates['/lastGoalScoredTeam'] = null; // Reseta se for subtraído (ex: gol anulado)
        //     }
        //     overlayRef.update(updates);
        // }

    </script>
</body>
</html>
